function formatCheck(email, callback) {
  const formatRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (formatRegex.test(email)) {
    console.log('Format check passed');
    callback(null, true);
  } else {
    console.log('Format check failed');
    callback('Email format is invalid', false);
  }
}

function domainCheck(email, callback) {
  const domain = email.split('@')[1];
  if (domain) {
    console.log('Domain check passed');
    callback(null, true);
  } else {
    console.log('Domain check failed');
    callback('Email must include a domain', false);
  }
}

function tldCheck(email, callback) {
  const tldRegex = /\.(com|org|net|edu|gov|mil|int|info|biz|name|museum|coop|aero|pro|[a-z]{2})$/i;
  if (tldRegex.test(email)) {
    console.log('TLD check passed');
    callback(null, true);
  } else {
    console.log('TLD check failed');
    callback('Email must include a valid top-level domain', false);
  }
}

function validateEmail(email, callback) {
  const checks = [formatCheck, domainCheck, tldCheck];
  const results = [];
  const errorMessages = [];

  function runCheck(index) {
    if (index === checks.length) {
      const isValid = errorMessages.length === 0;
      console.log('Validation results:', { results, errorMessages });
      callback(errorMessages, isValid);
      return;
    }
    
    checks[index](email, (error, result) => {
      if (error) errorMessages.push(error);
      results.push(result);
      runCheck(index + 1);
    });
  }

  runCheck(0);
}

module.exports = { validateEmail };

// Manual testing script
if (require.main === module) {
  const testEmails = [
    'test@example.com',
    'testexample.com',
    'test@example',
    'user+name@example.com',
    '@example.com',
    'test@mail.example.com',
    'test@example.c'
  ];

  testEmails.forEach(email => {
    validateEmail(email, (errors, isValid) => {
      console.log(`Email: ${email}`);
      console.log('Errors:', errors);
      console.log('Valid:', isValid);
      console.log('---');
    });
  });
}
