const EventEmitter = require('events');

class BankingSystem extends EventEmitter {
  constructor() {
    super();
    this.accounts = {};
  }

  createAccount(accountNumber) {
    if (this.accounts[accountNumber]) {
      throw new Error('Account already exists.');
    }
    this.accounts[accountNumber] = { balance: 0 };
    this.emit('accountCreated', accountNumber);
    return 'Account created successfully.';
  }

  deposit(accountNumber, amount) {
    this._validateAccount(accountNumber);
    if (amount <= 0) {
      throw new Error('Deposit amount must be positive.');
    }
    this.accounts[accountNumber].balance += amount;
    this.emit('moneyDeposited', accountNumber, amount);
    return `Deposited ${amount} successfully.`;
  }

  withdraw(accountNumber, amount) {
    this._validateAccount(accountNumber);
    if (amount <= 0) {
      throw new Error('Withdrawal amount must be positive.');
    }
    if (this.accounts[accountNumber].balance < amount) {
      throw new Error('Insufficient funds.');
    }
    this.accounts[accountNumber].balance -= amount;
    this.emit('moneyWithdrawn', accountNumber, amount);
    return `Withdrew ${amount} successfully.`;
  }

  getBalance(accountNumber) {
    this._validateAccount(accountNumber);
    return `Balance: ${this.accounts[accountNumber].balance}`;
  }

  _validateAccount(accountNumber) {
    if (!this.accounts[accountNumber]) {
      throw new Error('Account does not exist.');
    }
  }
}

// Event listeners for logging
const bankingSystem = new BankingSystem();

bankingSystem.on('accountCreated', (accountNumber) => {
  console.log(`Account ${accountNumber} created.`);
});

bankingSystem.on('moneyDeposited', (accountNumber, amount) => {
  console.log(`Deposited ${amount} into account ${accountNumber}.`);
});

bankingSystem.on('moneyWithdrawn', (accountNumber, amount) => {
  console.log(`Withdrew ${amount} from account ${accountNumber}.`);
});

module.exports = BankingSystem;

// Example usage for manual testing
if (require.main === module) {
  const bank = new BankingSystem();
  
  console.log(bank.createAccount('12345')); // Account 12345 created.
  console.log(bank.deposit('12345', 100)); // Deposited 100 into account 12345.
  console.log(bank.withdraw('12345', 50)); // Withdrew 50 from account 12345.
  console.log(bank.getBalance('12345')); // Balance: 50
}
